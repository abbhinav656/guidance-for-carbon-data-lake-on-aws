AWSTemplateFormatVersion: '2010-09-09'
Description: 'AWS Step Functions Example'

Parameters:
  definitionS3Location:
    Type: String
    Description: S3 Bucket where JSON definition is stored 
  dataCompactionJobName:
    Type: String
    Description: Name of Glue Data Compaction Job
  dataFlushJobName:
    Type: String
    Description: Name of Glue Data Flush Job
  createIndividualAthenaViewsLambdaName:
    Type: String
    Description: Name of Lambda function to create individual Athena Views
  createCombinedAthenaViewLambdaName:
    Type: String
    Description: Name of Lambda function to create combined Athena View
  stateMachineRoleArn:
    Type: String
    Description: ARN for IAM role to be assumed by state machine

Resources:
  # Step functions state machine
  NightlyDataCompactionStateMachine:
    Type: 'AWS::StepFunctions::StateMachine'
    Properties:
      DefinitionS3Location:
        Bucket: !Ref definitionS3Location
        Key: stateMachineDefinition.json
      DefinitionSubstitutions:
        dataCompactionJobName: !Ref dataCompactionJobName
        dataFlushJobName: !Ref dataFlushJobName
        createIndividualAthenaViewsLambdaName: !Ref createIndividualAthenaViewsLambdaName
        createCombinedAthenaViewLambdaName: !Ref createCombinedAthenaViewLambdaName
      RoleArn: !Ref stateMachineRoleArn

