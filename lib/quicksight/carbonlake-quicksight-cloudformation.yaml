AWSTemplateFormatVersion: 2010-09-09
Description: 'Automated deployment of QuickSight data sources.'
​
Parameters:
  DataSourceRegion:
    Type: String
    MinLength: 1
    Description: REQUIRED - Region in which the data source exists (i.e. us-east-1).
​
  AthenaWorkGroup: #how can this be removed?
    Type: String
    MinLength: 1
    Default : primary
    Description: Name of Athena workgroup used to run queries against underlying datasets.
​
Resources:
  CarbonLakeAthenaDataSource:
    Type: AWS::QuickSight::DataSource
    Properties:
      DataSourceId: CarbonLake-Athena-DataSource-2
      Name: CarbonLake Athena Data Source 2
      AwsAccountId: !Ref AWS::AccountId
      Type: ATHENA
      DataSourceParameters:
        AthenaParameters:
          WorkGroup: !Ref AthenaWorkGroup
      Permissions:
        - Principal: !Join
            - ''
            - - 'arn:aws:quicksight:'
              - !Ref DataSourceRegion
              - ':'
              - !Ref AWS::AccountId
              - ':group/default/BI-Admins' #default granting permissions to read/edit dataset to BI Admins QuickSight user group
          Actions:
            - quicksight:UpdateDataSourcePermissions
            - quicksight:DescribeDataSource
            - quicksight:DescribeDataSourcePermissions
            - quicksight:PassDataSource
            - quicksight:UpdateDataSource
            - quicksight:DeleteDataSource
